#!/usr/bin/env ruby

if ARGV[0] == 'setup'

  puts 'Creating bootstrap "/.testme"'

  File.open('./.testme', 'w') {|f| f.write(
%q[require "testme"

TESTME_DIR = '/test/'
TESTME_FORMAT = :console
TESTME_COLORS = :default]
)}

  puts 'Creating test folder "/test"'

  Dir::mkdir('./test/') unless File.directory?("./test/") || File.exists?("./test/")
  
  puts 'Creating empty test file "/app.test.rb"'

  File.open('./test/app.test.rb', 'w') {|f| f.write(
""
)}

  puts 'Setup complete'

else

  TESTME_RUNNING = true

  if File.exists?("#{Dir.pwd}/.testme")
    load "#{Dir.pwd}/.testme"
  else
    require "testme"
  end

  if ARGV.empty?
    testme do
      Dir["#{Dir.pwd}/#{TestMe::TESTME_DIR}/**/*.rb"].each{|f| load f } 
    end

  else
    ARGV.each do |arg|
      @file = "#{Dir.pwd}/#{arg}"

      # Check if directory
      if File.directory? @file
        Dir["#{@file}/**/*.rb"].each{|f| load f } 
      elsif File.exists? @file
        if @file.include? '.test.rb'
          testme do
            load @file
          end
        else
          require @file
        end
      end
    end

  end

end
