#!/usr/bin/env ruby

if ARGV[0] == 'setup'

  puts 'Creating bootstrap "/.testme"'

  File.open("./.testme", "w") {|f| f.write(
%q[TESTME_DIR = '/test/'
TESTME_SUFFIX = '.test.rb'
TESTME_FORMAT = :console
TESTME_COLORS = :default

require "testme"]
)} unless File.exists?("./.testme")

  puts 'Creating test folder "/test"'

  Dir::mkdir('./test/') unless File.directory?("./test/") || File.exists?("./test/")
  
  puts 'Creating empty test file "/app.test.rb"'

  File.open('./test/app.test.rb', 'w') {|f| f.write(
""
)} unless File.exists?("./.test/app.test.rb")

  puts 'Setup complete'

else

  TESTME_INIT = true

  if File.exists?("#{Dir.pwd}/.testme")
    load "#{Dir.pwd}/.testme"
  else
    require "testme"
  end

  TESTME_RUNNING = true

  if ARGV.empty?
    testme do
      Dir["#{Dir.pwd}/#{TestMe::TESTME_DIR}/**/*#{TestMe::TESTME_SUFFIX}"].each{|f| load f } 
    end

  else
    ARGV.each do |arg|
      @file = "#{Dir.pwd}/#{arg}"

      # Check if directory
      if File.directory?(@file)
        Dir["#{@file}/**/*.rb"].each do |f| 
          if @file.include?(TestMe::TESTME_SUFFIX)
            testme do
              load @file
            end
          else
            load @file
          end
        end
      elsif File.exists?(@file)
        if @file.include?(TestMe::TESTME_SUFFIX)
          testme do
            load @file
          end
        else
          load @file
        end
      end
    end
  end

end
